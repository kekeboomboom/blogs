# 源和目的地、路由



## 源

源在老的SMH概念中是与路由一起的。现在新的平台将源和目的地的创建与路由的创建分离开了。

- 创建源。仅仅在我的数据库记录一份，不调用SMH的接口。
- 删除源。如果源在使用那么不能删。如果源与路由联系了，但没使用那么删除源同时要删除路由和目的地。如果源与路由没有联系，那么直接删除源即可。
- 修改源。如果源没有与路由联系，那么仅仅需修改我自己数据库中数据。如果源与路由联系，那么我就需要调用SMH的修改路由的接口（调用前还需判断路由是否在运行状态，若运行状态则不可修改）
- 查询源。注意其中state即可。此state的值，需要创建源、创建路由、删除路由、启停路由时进行相应的修改。



## 目的地

- 创建目的地。创建目的地，仅在我数据库记录一份，启停状态默认为true
- 删除目的地。如果目的地没在用，那么直接删除数据库中即可。如果目的地与路由联系，且目的地为停止状态，那么需要删除数据库和调用SMH中删除目的地的接口。如果目的地与路由联系，且目的地为启用状态那么就不能删除
- 更新目的地。如果目的地没在用，那么直接更新数据库。如果目的地与路由联系且为启用状态，那么不可更新。如果与路由联系且停止状态，更新数据库并且调用SMH接口。
- 查询目的地。直接返回数据库中的即可。注意state判断。注意state赋值，如果仅在数据库中创建state为0，如果创建路由与目的地联系，那么state为2。如果联系后停止，那么state为1



## 路由

- 创建路由。由于SMH接口限制，我们在创建路由的同时，既调用创建路由接口，又调用创建目的地接口。更新源state状态、路由表新建路由、更新目的地表src_uuid和dest_uuid
- 删除路由。如果路由使用中，那么不可删除。如果路由停止，调用删除路由接口，删除路由表信息，更新源状态，更新目的地uuid等字段
- 更新路由。暂时只支持修改路由名和对路由增删目的地。调用SMH接口
- 查询路由。
- 更新路由状态。关闭路由后，无论目的地是否开启，都可以对目的地进行删除和修改。当前端获取目的地列表时，只要此目的地关联的路由关闭了，那么我就标识此目的地state为1